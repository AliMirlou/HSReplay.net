{% extends "account/base.html" %}
{% load setting from web_extras %}

{% block content %}
	{% if authorized_apps.count %}
		<section id="oauth2-authorized-applications" class="box-section">
			<h3>Authorized Applications</h3>
			<div class="inner">
				<p>
					You have granted these applications access to your HSReplay.net account.
					They do not have access to your Blizzard account.
				</p>

				<ul class="list-group list-group-no-margin">
				{% for token in authorized_apps %}
					<li class="list-group-item">
						<form
							method="POST"
							action="{% url 'oauth2_revoke_access' %}"
							class="pull-right"
							onsubmit="return confirm('Are you sure? There is no undo!')"
						>
							{% csrf_token %}
							<input type="hidden" name="client_id" value="{{ token.application.client_id }}"/>
							<button type="submit" class="btn btn-danger">Revoke access</button>
						</form>
						<strong>{{ token.application }}</strong>
						{% if token.application.homepage %}
							&nbsp;<strong><a href="{{ token.application.homepage }}" target="_blank" rel="noopener"><span class="glyphicon glyphicon-globe"></span> Website</strong></a>
						{% endif %}

						{% if token.application.description %}
							<br />
							<em>{{ token.application.description }}</em>
						{% endif %}
						<div class="clearfix"></div>
					</li>
				{% endfor %}
				</ul>
			</div>
		</section>
	{% endif %}

	<section id="account-oauth2-applications" class="box-section">
		<h3>Developer Applications</h3>

		<div class="inner">
		{% if not application_list.count %}
			<p>
				Want to use our OAuth2 API in your own app?
				<a href="mailto:{% setting 'DEFAULT_FROM_EMAIL' %}">Contact us</a> to apply for a token.
			</p>
		{% else %}
			<table class="table table-bordered">
				<thead>
					<th>Application</th>
					<th>Homepage</th>
					<th>Client ID</th>
					<th>Users</th>
				</thead>
			{% for app in application_list %}
				<tr>
					<td><a href="{% url 'oauth2_app_update' pk=app.pk %}">{{ app }}</a></td>
					<td><a href="{{ app.homepage }}">{{ app.homepage }}</a></td>
					<td>{{ app.client_id }}</td>
					<td>{{ app.accesstoken_set.count }}</td>
				</tr>
			{% endfor %}
			</table>
		{% endif %}
		</div>
	</section>
{% endblock %}
